<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>ExtJS 5.1.0</title>
    <link rel="stylesheet" type="text/css" href="ext-5.1.0/ext-theme-classic/build/resources/ext-theme-classic-all.css" />
    <script type="text/javascript" src="ext-5.1.0/ext-all.js"></script>
    <script type="text/javascript" src="ext-5.1.0/ext-theme-classic/build/ext-theme-classic.js"></script>
  </head>
  <body> 
    <div id="panel" style="width: 100%; height: 100%;">
      <script>
        /* global Ext */
        Ext.QuickTips.init();
        var win = Ext.create('Ext.window.Window', {
          title: 'iframe Window',
          closable: true,
          closeAction: 'hide',
          width: 400,
          modal: true,
          minWidth: 350,
          height: 150,
          layout: 'fit',
          items: [{
              xtype: 'label',
              text: 'Extshs test'
            }]
        });
        //      Ext.onReady(function() {
        //        win.show();
        //      });

        Ext.create('Ext.data.Store', {
          storeId: 'simpsonsStore',
          fields: ['name', 'email', 'phone', 'birthDate', 'action'],
          data: {'items': [
              {'name': 'Lisa', "email": "lisa@simpsons.com", "phone": "5551111224", "birthDate": "05/10/1990"},
              {'name': 'Lisa', "email": "lol@simpsons.com", "phone": "5551111224", "birthDate": "07/17/1992"},
              {'name': 'Bart', "email": "bart@simpsons.com", "phone": "5552221234", "birthDate": "05/04/1993"},
              {'name': 'Homer', "email": "homer@simpsons.com", "phone": "5552221244", "birthDate": "04/19/1991"},
              {'name': 'Marge', "email": "marge@simpsons.com", "phone": "5552221254", "birthDate": "10/20/1994"},
              {'name': 'Marge', "email": "marge@simpsons.com", "phone": "5552221254", "birthDate": "10/20/1994"},
              {'name': 'Marge', "email": "marge@simpsons.com", "phone": "5552221254", "birthDate": "10/20/1994"},
              {'name': 'Marge', "email": "marge@simpsons.com", "phone": "5552221254", "birthDate": "10/20/1994"},
              {'name': 'Marge', "email": "marge@simpsons.com", "phone": "5552221254", "birthDate": "10/20/1994"},
              {'name': 'Marge', "email": "marge@simpsons.com", "phone": "5552221254", "birthDate": "10/20/1994"},
              {'name': 'Marge', "email": "marge@simpsons.com", "phone": "5552221254", "birthDate": "10/20/1994"},
              {'name': 'Marge', "email": "marge@simpsons.com", "phone": "5552221254", "birthDate": "10/20/1994"},
              {'name': 'Marge', "email": "marge@simpsons.com", "phone": "5552221254", "birthDate": "10/20/1994"},
              {'name': 'Marge', "email": "marge@simpsons.com", "phone": "5552221254", "birthDate": "10/20/1994"},
              {'name': 'Marge', "email": "marge@simpsons.com", "phone": "5552221254", "birthDate": "10/20/1994"},
              {'name': 'Marge', "email": "marge@simpsons.com", "phone": "5552221254", "birthDate": "10/20/1994"},
              {'name': 'Marge', "email": "marge@simpsons.com", "phone": "5552221254", "birthDate": "10/20/1994"},
              {'name': 'Marge', "email": "marge@simpsons.com", "phone": "5552221254", "birthDate": "10/20/1994"},
              {'name': 'Homer', "email": "homer@simpsons.com", "phone": "5552221244", "birthDate": "04/19/1991"},
              {'name': 'Marge', "email": "marge@simpsons.com", "phone": "5552221254", "birthDate": "10/20/1994"},
              {'name': 'Marge', "email": "marge@simpsons.com", "phone": "5552221254", "birthDate": "10/20/1994"},
              {'name': 'Marge', "email": "marge@simpsons.com", "phone": "5552221254", "birthDate": "10/20/1994"},
              {'name': 'Marge', "email": "marge@simpsons.com", "phone": "5552221254", "birthDate": "10/20/1994"},
              {'name': 'Marge', "email": "marge@simpsons.com", "phone": "5552221254", "birthDate": "10/20/1994"},
              {'name': 'Marge', "email": "marge@simpsons.com", "phone": "5552221254", "birthDate": "10/20/1994"},
              {'name': 'Marge', "email": "marge@simpsons.com", "phone": "5552221254", "birthDate": "10/20/1994"},
              {'name': 'Marge', "email": "marge@simpsons.com", "phone": "5552221254", "birthDate": "10/20/1994"},
              {'name': 'Marge', "email": "marge@simpsons.com", "phone": "5552221254", "birthDate": "10/20/1994"},
              {'name': 'Marge', "email": "marge@simpsons.com", "phone": "5552221254", "birthDate": "10/20/1994"},
              {'name': 'Marge', "email": "marge@simpsons.com", "phone": "5552221254", "birthDate": "10/20/1994"},
              {'name': 'Marge', "email": "marge@simpsons.com", "phone": "5552221254", "birthDate": "10/20/1994"}
            ]},
          proxy: {
            type: 'memory',
            reader: {
              type: 'json',
              rootProperty: 'items'
            }
          }
        });

        Ext.create('Ext.grid.Panel', {
          title: 'Simpsons',
          store: Ext.data.StoreManager.lookup('simpsonsStore'),
          //     plugins: 'gridfilters',
          columns: [
            {text: 'Име', dataIndex: 'name', editor: {xtype: 'textfield', allowBlank: false}},
            {text: 'Email', dataIndex: 'email', flex: 1, editor: 'textfield'},
            {text: 'Телефон', dataIndex: 'phone', filter: 'number', editor: 'textfield'},
            {text: 'Дата на раждане', dataIndex: 'birthDate', editor: 'datefield', renderer: Ext.util.Format.dateRenderer('m/d/Y')},
            {
              xtype: 'actioncolumn',
              width: 30,
              sortable: false,
              menuDisabled: true,
              items: [{
                  icon: "img/icon/delete_icon.png",
                  tooltip: 'Изтрий запис',
                  handler: function(grid, rowIndex) {
                    var msgBox = Ext.MessageBox;
                    msgBox.buttonText = {
                      yes: '<span style="color: #083772"><b>Да</b></span>',
                      no: '<span style="color: #083772"><b>Не</b></span>'
                    };
                    msgBox.confirm('Изтриване', 'Сигурни ли сте, че искате да изтриете записа?', function(confirmation) {
                      if(confirmation === 'yes') {
                        grid.getStore().removeAt(rowIndex);
                      }
                    });

                  }
                }]
            }
          ],
          //        selType: 'rowmodel',
          //        plugins: [{
          //            ptype: 'rowediting',
          //            clicksToEdit: 2
          //          }],
          selType: 'cellmodel',
          plugins: 'cellediting',
          emptyText: 'Няма записи',
          autoWidth: true,
          autoScroll: true,
          tbar: [{
              xtype: 'button',
              text: 'Филтър',
              handler: function(btn) {
                var g = btn.up('grid');
                g.store.filter([{property: "name", anyMatch: true, value: 'Lisa'}, {property: "email", anyMatch: true, value: 'lisa@simpsons.com'}]);
              }
            },
            //          {
            //            xtype: 'button',
            //            text: 'Click me',
            //            handler: function(btn) {
            //              win.show();
            //            }
            //          },
            {
              xtype: 'button',
              icon: "img/icon/add_pic.png",
              text: 'Добави запис',
              handler: function(btn) {
                // Create a model instance
                var g = btn.up('grid');
                var rec = {
                  name: '',
                  email: '',
                  phone: 0,
                  birthDate: Ext.Date.clearTime(new Date())
                };

                g.getStore().insert(0, rec);
                //              this.cellEditing.startEditByPosition({
                //                row: 0,
                //                column: 0
                //              });
              }
            }
          ],
          layout: 'fit',
          height: 872,
          //     width: 400,
          dockedItems: [{
              xtype: 'pagingtoolbar',
              store: Ext.data.StoreManager.lookup('simpsonsStore'), // same store GridPanel is using
              dock: 'bottom',
              displayInfo: true,
              displayMsg: 'Записи от {0} до {1} от общо {2}',
              beforePageText: 'страница',
              afterPageText: 'от {0}',
              emptyMsg: "Няма записи"
            }],
          renderTo: Ext.getBody()
        });
      </script> 
    </div>
  </body>
</html>
